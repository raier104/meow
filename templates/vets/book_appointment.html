{% extends "base.html" %}
{% block title %}Book Appointment{% endblock %}
{% block content %}
<div class="container" style="max-width: 800px; margin: 2rem auto;">
  <!-- Back Navigation -->
  <div style="margin-bottom: 2rem;">
    <a href="{% url 'vets:clinic_detail' doctor.clinic.id %}" style="background:#6c757d;color:#fff;padding:8px 16px;border-radius:8px;text-decoration:none;font-size:0.9rem;">‚Üê Back to {{ doctor.clinic.name }}</a>
  </div>

  <!-- Main Dashboard Container -->
  <div style="background:#fff;border-radius:20px;box-shadow:0 8px 32px rgba(0,0,0,0.12);overflow:hidden;">
    
    <!-- Header Section -->
    <div style="background:linear-gradient(135deg, #2c5f5f 0%, #ff6b35 100%);padding:2rem;color:#fff;text-align:center;">
      <div style="display:flex;align-items:center;justify-content:center;gap:1rem;margin-bottom:1rem;">
        <div style="background:rgba(255,255,255,0.2);padding:1rem;border-radius:50%;width:80px;height:80px;display:flex;align-items:center;justify-content:center;">
          <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="#fff" viewBox="0 0 24 24">
            <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H5C3.89 1 3 1.89 3 3V21C3 22.11 3.89 23 5 23H19C20.11 23 21 22.11 21 21V9M19 9H14V4H5V21H19V9Z"/>
          </svg>
        </div>
      </div>
      <h1 style="margin:0;font-size:2.2rem;font-weight:700;">Book Appointment</h1>
      <p style="margin:0.5rem 0 0 0;font-size:1.1rem;opacity:0.9;">Schedule your visit with our veterinary expert</p>
    </div>

    <!-- Doctor Information Card -->
    <div style="padding:2rem;background:#f8fdff;border-bottom:1px solid #e3f2fd;">
      <div style="display:flex;align-items:center;gap:1.5rem;margin-bottom:1.5rem;">
        <div style="background:#2c5f5f;color:#fff;padding:1rem;border-radius:50%;width:80px;height:80px;display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:700;">
          Dr
        </div>
        <div>
          <h2 style="margin:0;color:#2c5f5f;font-size:1.8rem;">Dr. {{ doctor.name }}</h2>
          <p style="margin:0.25rem 0;color:#666;font-size:1.1rem;">{{ doctor.specialization|default:"General Veterinarian" }}</p>
          <div style="display:flex;align-items:center;gap:0.5rem;margin-top:0.5rem;">
            <span style="background:#ff6b35;color:#fff;padding:4px 12px;border-radius:20px;font-size:0.9rem;font-weight:600;">{{ doctor.fee }} TK</span>
            <span style="background:#28a745;color:#fff;padding:4px 12px;border-radius:20px;font-size:0.9rem;font-weight:600;">Available</span>
          </div>
        </div>
      </div>
      
      <!-- Clinic Info -->
      <div style="background:#fff;padding:1.5rem;border-radius:12px;border-left:4px solid #2c5f5f;">
        <h4 style="margin:0 0 0.5rem 0;color:#2c5f5f;">Clinic Information</h4>
        <p style="margin:0.25rem 0;"><strong>Name:</strong> {{ doctor.clinic.name }}</p>
        <p style="margin:0.25rem 0;"><strong>Address:</strong> {{ doctor.clinic.address }}</p>
        {% if doctor.clinic.phone %}
        <p style="margin:0.25rem 0;"><strong>Phone:</strong> {{ doctor.clinic.phone }}</p>
        {% endif %}
      </div>
    </div>

    <!-- Booking Form Section -->
    <div style="padding:2rem;">
      <h3 style="color:#2c5f5f;margin-bottom:1.5rem;font-size:1.4rem;">Available Appointment Slots</h3>
      
      <div id="time-slots-container">
        {% if timeslots %}
          <div style="display:grid;gap:1rem;">
            {% for slot in timeslots %}
              <div style="background:#fff;border:2px solid #e9ecef;padding:1.5rem;border-radius:12px;display:flex;justify-content:space-between;align-items:center;transition:all 0.3s;box-shadow:0 2px 8px rgba(0,0,0,0.05);">
                <div>
                  <div style="font-weight:600;font-size:1.1rem;color:#2c5f5f;margin-bottom:0.25rem;">
                    {{ slot.start|date:"l, F j, Y" }}
                  </div>
                  <div style="color:#666;font-size:1rem;">
                    {{ slot.start|date:"g:i A" }} - {{ slot.end|date:"g:i A" }}
                  </div>
                </div>
                <button onclick="bookAppointment('{{ slot.id }}')" style="background:linear-gradient(135deg, #ff6b35 0%, #2c5f5f 100%);color:#fff;padding:12px 24px;border:none;border-radius:8px;font-weight:600;cursor:pointer;transition:transform 0.3s;white-space:nowrap;">
                  üìÖ Book This Slot
                </button>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div style="background:#fff3cd;color:#856404;padding:2rem;border-radius:8px;text-align:center;border:1px solid #ffeaa7;">
            <div style="margin-bottom:1rem;">
              <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="#f39c12" viewBox="0 0 24 24">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
              </svg>
            </div>
            <h4 style="margin:0 0 0.5rem 0;color:#b7791f;">No Available Time Slots</h4>
            <p style="margin:0 0 1rem 0;font-size:0.95rem;">Unfortunately, this doctor has no available appointment slots at the moment.</p>
            <p style="margin:0;font-size:0.9rem;color:#8d6e15;">Please contact the clinic directly at {{ doctor.clinic.phone|default:"the clinic" }} or try booking with another doctor.</p>
            <div style="margin-top:1.5rem;">
              <a href="{% url 'vets:clinic_detail' doctor.clinic.id %}" style="background:#f39c12;color:#fff;padding:10px 20px;border-radius:8px;text-decoration:none;font-weight:600;">
                ‚Üê Choose Another Doctor
              </a>
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script>
function bookAppointment(slotId) {
    // Create a form and submit it
    const form = document.createElement('form');
    form.method = 'POST';
    form.style.display = 'none';
    
    // Add CSRF token
    const csrfToken = document.createElement('input');
    csrfToken.type = 'hidden';
    csrfToken.name = 'csrfmiddlewaretoken';
    csrfToken.value = '{{ csrf_token }}';
    form.appendChild(csrfToken);
    
    // Add time slot ID
    const timeInput = document.createElement('input');
    timeInput.type = 'hidden';
    timeInput.name = 'time';
    timeInput.value = slotId;
    form.appendChild(timeInput);
    
    document.body.appendChild(form);
    form.submit();
}

// Set minimum date to today
document.addEventListener('DOMContentLoaded', function() {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('date').setAttribute('min', today);
});
</script>

<style>
button:hover {
  transform: translateY(-2px);
}
</style>
{% endblock %}
